<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Somos White · Comercios locales</title>
    <meta name="description"
        content="Directorio de comercios con categorías y subcategorías. Buscador central, filtros, promociones y horarios. 100% responsive con Bootstrap 5." />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary: #1e7a46;
            /* verde protagonista */
            --accent: #ffd166;
            /* acento cálido */
            --ink: #1f2937;
            /* texto */
            --muted: #6b7280;
            /* texto suave */
            --bg: #f7faf8;
            /* fondo sutil */
        }

        html,
        body {
            height: 100%
        }

        body {
            color: var(--ink);
            background: var(--bg)
        }

        .navbar-brand strong {
            letter-spacing: .2px
        }

        .chip {
            --bs-btn-padding-y: .375rem;
            --bs-btn-padding-x: .85rem;
            --bs-btn-font-size: .9rem
        }

        .chip.active,
        .chip:hover {
            background: var(--primary) !important;
            color: #fff !important
        }

        .hero {
            background: linear-gradient(120deg, rgba(30, 122, 70, .9), rgba(30, 122, 70, .65)), url('https://images.unsplash.com/photo-1514996937319-344454492b37?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat;
            color: #fff
        }

        .hero .form-control::placeholder {
            color: #e5e7eb
        }

        .carousel-caption {
            backdrop-filter: blur(6px);
            background: rgba(0, 0, 0, .35);
            border-radius: 14px
        }

        /* Slide: altura uniforme */
        #promoCarousel .carousel-item>img {
            height: clamp(220px, 40vw, 420px);
            width: 100%;
            object-fit: cover
        }

        /* Buscador protagonista en HERO */
        .search-hero .input-group {
            border-radius: 14px;
            overflow: hidden
        }

        .search-hero .form-control {
            padding-left: .25rem
        }

        .search-hero .input-group .form-control {
            box-shadow: none
        }

        .search-hero .input-group.input-group-lg .input-group-text {
            padding-left: 1rem;
            padding-right: .75rem
        }

        .search-hero .btn {
            font-weight: 600
        }

        /* Card contenedor del buscador + tip */
        .search-card {
            background: #fff;
            border-radius: 14px;
            padding: 1rem
        }

        .search-tip {
            color: var(--muted)
        }

        .category-badge {
            position: absolute;
            top: .75rem;
            left: .75rem;
            background: var(--accent);
            color: #000;
            font-weight: 600;
            border-radius: 999px;
            padding: .25rem .6rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, .08)
        }

        .card-merchant {
            border: 0;
            overflow: hidden;
            box-shadow: 0 12px 28px rgba(0, 0, 0, .06)
        }

        .card-merchant img {
            aspect-ratio: 4/3;
            object-fit: cover
        }

        .meta {
            font-size: .92rem;
            color: var(--muted)
        }

        .hours {
            font-size: .9rem
        }

        .hours .badge {
            font-weight: 600
        }

        .open-badge {
            background: #16a34a
        }

        .closed-badge {
            background: #ef4444
        }

        .muted-link {
            color: inherit;
            text-decoration: none
        }

        .muted-link:hover {
            color: var(--primary)
        }

        .filter-bar {
            position: sticky;
            top: 64px;
            z-index: 1020;
            background: linear-gradient(#fff, #fff8)
        }

        .shadow-soft {
            box-shadow: 0 10px 25px rgba(0, 0, 0, .06)
        }

        footer a {
            color: inherit
        }
    </style>
</head>

<body>
    <!-- NAV -->
    <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#" aria-label="Inicio Somos White">
                <i class="bi bi-shop-window fs-3 text-success"></i>
                <strong>somos white</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
                aria-controls="nav" aria-expanded="false" aria-label="Abrir menú">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="nav" class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="#promos">Promos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#listado">Comercios</a></li>
                    <li class="nav-item"><a class="nav-link" href="#categorias">Categorías</a></li>
                </ul>
                <!-- Buscador eliminado del navbar a pedido -->
            </div>
        </div>
    </nav>

    <!-- HERO / PROMOS -->
    <header id="promos" class="hero py-5">
        <div class="container">
            <!-- BUSCADOR CENTRADO EN HERO -->
            <div class="row justify-content-center mb-4">
                <div class="col-12 col-lg-8">
                    <form class="search-hero" role="search"
                        onsubmit="event.preventDefault(); document.getElementById('listado').scrollIntoView({behavior:'smooth'});">
                        <div class="search-card shadow-soft">
                            <div class="input-group input-group-lg">
                                <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                                <input id="q" class="form-control border-start-0" type="search"
                                    placeholder="Buscar comercios, productos o etiquetas…" aria-label="Buscar" />
                                <button class="btn btn-success" type="button"
                                    onclick="document.getElementById('listado').scrollIntoView({behavior:'smooth'})">Buscar</button>
                            </div>
                            <div class="search-tip small mt-2"><strong>Tip:</strong> probá “sin tacc”, “orgánicos”,
                                “masa madre”…</div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row align-items-center gy-4">
                <div class="col-lg-6">
                    <span class="badge bg-light text-dark mb-2">Comercio local • Ing. White</span>
                    <h1 class="display-5 fw-bold">Comé mejor, comprá mejor</h1>
                    <p class="lead mb-4">Descubrí comercios por rubro, compará horarios y aprovechá promociones. Todo en
                        un solo lugar.</p>
                    <div class="d-flex gap-2 flex-wrap">
                        <a href="#listado" class="btn btn-light btn-lg text-dark"><i class="bi bi-list"></i> Ver
                            comercios</a>
                        <a href="#categorias" class="btn btn-outline-light btn-lg"><i class="bi bi-funnel"></i> Filtrar
                            por rubro</a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div id="promoCarousel" class="carousel slide shadow-soft rounded-4 overflow-hidden"
                        data-bs-ride="carousel">
                        <div class="carousel-indicators"></div>
                        <div class="carousel-inner"></div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#promoCarousel"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Anterior</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#promoCarousel"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Siguiente</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- CATEGORÍAS -->
    <section id="categorias" class="py-4 border-top bg-white">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center gap-2">
                <button class="btn btn-outline-secondary chip active" data-category="all"><i class="bi bi-grid"></i>
                    Todas</button>
                <!-- chips dinámicos -->
                <div id="chips" class="d-flex flex-wrap gap-2"></div>
                <div class="ms-auto d-flex gap-2 align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false" id="subcatBtn">Subcategoría</button>
                        <ul id="subcatMenu" class="dropdown-menu"></ul>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="openNow">
                        <label class="form-check-label" for="openNow">Abierto ahora</label>
                    </div>
                    <select id="sort" class="form-select" style="max-width: 220px">
                        <option value="name-asc">Ordenar: Nombre (A→Z)</option>
                        <option value="name-desc">Nombre (Z→A)</option>
                        <option value="rating-desc">Mejor calificación</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- LISTADO -->
    <main id="listado" class="py-5">
        <div class="container">
            <div id="grid" class="row g-4"><!-- Cards por JS --></div>
        </div>
    </main>

    <!-- MODAL DETALLE -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <img id="detailImg" class="img-fluid rounded-3" alt="Foto del comercio" />
                        </div>
                        <div class="col-md-6">
                            <div class="mb-2"><span id="detailCategory" class="badge text-bg-success"></span> <span
                                    id="detailSubcategory" class="badge text-bg-secondary"></span></div>
                            <p class="mb-2"><i class="bi bi-geo-alt"></i> <span id="detailAddress"></span></p>
                            <p class="mb-2"><i class="bi bi-telephone"></i> <a id="detailPhone" class="muted-link"
                                    target="_blank" rel="noopener"></a></p>
                            <p class="mb-3"><i class="bi bi-link-45deg"></i> <a id="detailSite" class="muted-link"
                                    target="_blank" rel="noopener"></a></p>
                            <div class="hours">
                                <h6>Horarios</h6>
                                <ul id="detailHours" class="list-unstyled mb-0"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <a id="mapsBtn" class="btn btn-success" target="_blank" rel="noopener"><i class="bi bi-map"></i>
                        Cómo llegar</a>
                    <a id="mapsBtn" href="comercio.html" class="btn btn-success" target="_blank" rel="noopener"><i
                            class="bi bi-globe"></i> Ir a la web</a>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-4 border-top bg-white">
        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
            <p class="mb-0">© <span id="year"></span> Somos White</p>
            <div class="d-flex gap-3 align-items-center">
                <a href="#" class="muted-link">Privacidad</a>
                <a href="#" class="muted-link">Términos</a>
                <a href="#" class="muted-link">Contacto</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==================
        // Datos de ejemplo
        // ==================
        const promos = [
            { img: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1600&auto=format&fit=crop', title: 'Promo de Bienvenida', text: '10% OFF en tu primera compra en locales adheridos' },
            { img: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=1600&auto=format&fit=crop', title: 'Gran variedad saludable', text: 'Granel, sin TACC, orgánicos y más' },
            { img: 'https://images.unsplash.com/photo-1490818387583-1baba5e638af?q=80&w=1600&auto=format&fit=crop', title: 'Pan integral fresco', text: 'Panaderías con surtido integral y masa madre' }
        ];

        const merchants = [
            { id: 'diet1', name: 'Vida Sana Dietética', address: 'Av. Guillermo Torres 123, Ing. White', phone: '+54 291 555-0101', site: 'https://ejemplo.com', category: 'Dietéticas', subcategory: 'Orgánicos', rating: 4.8, img: 'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1400&auto=format&fit=crop', tags: ['granel', 'sin tacc', 'frutos secos'], hours: { 1: ['09:00-13:00', '17:00-20:30'], 2: ['09:00-13:00', '17:00-20:30'], 3: ['09:00-13:00', '17:00-20:30'], 4: ['09:00-13:00', '17:00-20:30'], 5: ['09:00-13:00', '17:00-21:00'], 6: ['09:30-13:30'], 0: [] }, lat: -38.788, lng: -62.266 },
            { id: 'diet2', name: 'Semilla & Vida', address: 'Belgrano 450, Ing. White', phone: '+54 291 555-0202', site: '', category: 'Dietéticas', subcategory: 'Suplementos', rating: 4.6, img: 'https://images.unsplash.com/photo-1505575967455-40e256f73376?q=80&w=1400&auto=format&fit=crop', tags: ['proteínas', 'vitaminas', 'sin azúcar'], hours: { 1: ['09:00-13:00', '17:00-20:30'], 2: ['09:00-13:00', '17:00-20:30'], 3: ['09:00-13:00', '17:00-20:30'], 4: ['09:00-13:00', '17:00-20:30'], 5: ['09:00-13:00', '17:00-21:00'], 6: ['10:00-13:00'], 0: [] }, lat: -38.79, lng: -62.27 },
            { id: 'pan1', name: 'Masa Madre Panadería', address: 'Alsina 980, Bahía Blanca', phone: '+54 291 555-0303', site: 'https://ejemplo-pan.com', category: 'Panaderías', subcategory: 'Integral', rating: 4.9, img: 'https://images.unsplash.com/photo-1549931319-a545dcf3bc73?q=80&w=1400&auto=format&fit=crop', tags: ['masa madre', 'integral', 'facturas'], hours: { 1: ['07:30-13:30', '16:30-20:00'], 2: ['07:30-13:30', '16:30-20:00'], 3: ['07:30-13:30', '16:30-20:00'], 4: ['07:30-13:30', '16:30-20:00'], 5: ['07:30-20:30'], 6: ['08:30-13:30'], 0: ['08:30-12:30'] }, lat: -38.72, lng: -62.27 },
            { id: 'pan2', name: 'Trigo Dorado', address: 'Saavedra 120, Bahía Blanca', phone: '+54 291 555-0404', site: '', category: 'Panaderías', subcategory: 'Sin TACC', rating: 4.3, img: 'https://images.unsplash.com/photo-1541781774459-bb2af2f05b55?q=80&w=1400&auto=format&fit=crop', tags: ['sin tacc', 'budines', 'galletitas'], hours: { 1: ['08:00-13:00', '17:00-20:00'], 2: ['08:00-13:00', '17:00-20:00'], 3: ['08:00-13:00', '17:00-20:00'], 4: ['08:00-13:00', '17:00-20:00'], 5: ['08:00-21:00'], 6: ['09:00-13:00'], 0: [] }, lat: -38.73, lng: -62.25 },
            { id: 'fer1', name: 'El Tornillo Ferretería', address: 'Sarmiento 300, Ing. White', phone: '+54 291 555-0505', site: '', category: 'Ferreterías', subcategory: 'Herramientas', rating: 4.5, img: 'https://images.unsplash.com/photo-1503387762-592deb58ef4e?q=80&w=1400&auto=format&fit=crop', tags: ['herramientas', 'pinturas', 'electricidad'], hours: { 1: ['08:30-12:30', '16:30-20:30'], 2: ['08:30-12:30', '16:30-20:30'], 3: ['08:30-12:30', '16:30-20:30'], 4: ['08:30-12:30', '16:30-20:30'], 5: ['08:30-20:30'], 6: ['09:00-13:00'], 0: [] }, lat: -38.79, lng: -62.26 },
            { id: 'fer2', name: 'Casa Herrero', address: 'Chiclana 700, Bahía Blanca', phone: '+54 291 555-0606', site: '', category: 'Ferreterías', subcategory: 'Tornillos', rating: 4.1, img: 'https://images.unsplash.com/photo-1516542076529-1ea3854896e1?q=80&w=1400&auto=format&fit=crop', tags: ['tornillería', 'herrajes', 'adhesivos'], hours: { 1: ['08:30-12:30', '16:30-20:30'], 2: ['08:30-12:30', '16:30-20:30'], 3: ['08:30-12:30', '16:30-20:30'], 4: ['08:30-12:30', '16:30-20:30'], 5: ['08:30-20:30'], 6: ['09:00-13:00'], 0: [] }, lat: -38.72, lng: -62.23 }
        ];

        // ==================
        // Helpers de horarios
        // ==================
        const dayNames = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];

        function parseTime(str) { // 'HH:MM' → minutos desde 00:00
            const [h, m] = str.split(':').map(Number);
            return h * 60 + m;
        }

        function isOpenNow(hours) {
            const now = new Date();
            const localDay = now.getDay();
            const minutes = now.getHours() * 60 + now.getMinutes();
            const slots = hours[localDay] || [];
            return slots.some(r => {
                const [a, b] = r.split('-');
                return minutes >= parseTime(a) && minutes <= parseTime(b);
            });
        }

        function formatTodayRange(hours) {
            const d = new Date().getDay();
            const slots = hours[d] || [];
            if (!slots.length) return 'Cerrado hoy';
            return slots.join(' · ');
        }

        function generateHoursListHTML(m) {
            const todayIndex = new Date().getDay();
            let html = '<ul class="list-unstyled small mb-0">';
            for (let d = 0; d < 7; d++) {
                const slots = m.hours[d] || [];
                const label = d === todayIndex ? dayNames[d] + ' (hoy)' : dayNames[d];
                const val = slots.length ? slots.join(' · ') : '<span class="text-muted">Cerrado</span>';
                html += `<li><span class="fw-semibold">${label}</span>: ${val}</li>`;
            }
            html += '</ul>';
            return html;
        }

        // ==================
        // Render: Promos
        // ==================
        (function renderPromos() {
            const inner = document.querySelector('#promoCarousel .carousel-inner');
            const ind = document.querySelector('#promoCarousel .carousel-indicators');
            if (!inner || !ind) return;
            promos.forEach((p, i) => {
                const item = document.createElement('div');
                item.className = 'carousel-item' + (i === 0 ? ' active' : '');
                item.innerHTML = `
          <img src="${p.img}" class="d-block w-100" alt="${p.title}" loading="lazy">
          <div class="carousel-caption text-start p-4">
            <h5 class="mb-1">${p.title}</h5>
            <p class="mb-0">${p.text}</p>
          </div>`;
                inner.appendChild(item);
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.setAttribute('data-bs-target', '#promoCarousel');
                btn.setAttribute('data-bs-slide-to', String(i));
                btn.setAttribute('aria-label', `Ir al slide ${i + 1}`);
                if (i === 0) { btn.className = 'active'; btn.setAttribute('aria-current', 'true'); }
                ind.appendChild(btn);
            });
        })();

        // ==================
        // Filtros y estado
        // ==================
        const state = { q: '', category: 'all', subcategory: '', open: false, sort: 'name-asc' };

        function unique(arr) { return [...new Set(arr)]; }
        function getCategories() { return unique(merchants.map(m => m.category)); }
        function getSubcategories(cat) {
            const scoped = cat === 'all' ? merchants : merchants.filter(m => m.category === cat);
            return unique(scoped.map(m => m.subcategory).filter(Boolean));
        }

        function buildChips() {
            const chips = document.getElementById('chips');
            if (!chips) return;
            chips.innerHTML = '';
            getCategories().forEach(cat => {
                const b = document.createElement('button');
                b.className = 'btn btn-outline-secondary chip';
                b.dataset.category = cat;
                b.innerHTML = `<i class="bi bi-tag"></i> ${cat}`;
                b.addEventListener('click', () => {
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    b.classList.add('active');
                    state.category = cat; state.subcategory = '';
                    const subBtn = document.getElementById('subcatBtn');
                    if (subBtn) subBtn.textContent = 'Subcategoría';
                    buildSubcategories();
                    render();
                });
                chips.appendChild(b);
            });
        }

        function buildSubcategories() {
            const menu = document.getElementById('subcatMenu');
            if (!menu) return;
            menu.innerHTML = '';
            const subs = getSubcategories(state.category);
            if (!subs.length) {
                const li = document.createElement('li');
                li.innerHTML = '<span class="dropdown-item-text text-muted">Sin subcategorías</span>';
                menu.appendChild(li);
                return;
            }
            const clear = document.createElement('li');
            clear.innerHTML = '<button class="dropdown-item">Todas</button>';
            clear.querySelector('button')?.addEventListener('click', () => {
                state.subcategory = '';
                const subBtn = document.getElementById('subcatBtn');
                if (subBtn) subBtn.textContent = 'Subcategoría';
                render();
            });
            menu.appendChild(clear);
            const divider = document.createElement('li');
            divider.innerHTML = '<hr class="dropdown-divider">';
            menu.appendChild(divider);
            subs.forEach(sc => {
                const li = document.createElement('li');
                li.innerHTML = `<button class="dropdown-item">${sc}</button>`;
                li.querySelector('button')?.addEventListener('click', () => {
                    state.subcategory = sc;
                    const subBtn = document.getElementById('subcatBtn');
                    if (subBtn) subBtn.textContent = sc;
                    render();
                });
                menu.appendChild(li);
            });
        }

        // ==================
        // Render: Cards
        // ==================
        function cardTemplate(m) {
            const open = isOpenNow(m.hours);
            const today = formatTodayRange(m.hours);
            const collapseId = `hrs-${m.id}`;
            const stars = '★'.repeat(Math.round(m.rating));
            const empties = '☆'.repeat(5 - Math.round(m.rating));
            return `
        <div class="col-12 col-sm-6 col-lg-4">
          <article class="card card-merchant h-100" itemscope itemtype="https://schema.org/LocalBusiness">
            <div class="position-relative">
              <img src="${m.img}" class="w-100" alt="${m.name}" loading="lazy" itemprop="image">
              <span class="category-badge">${m.category}</span>
            </div>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title mb-1" itemprop="name">${m.name}</h5>
              <div class="meta mb-2"><i class="bi bi-geo-alt"></i> <span itemprop="address">${m.address}</span></div>
              <div class="hours mb-2">
                <span class="badge ${open ? 'open-badge' : 'closed-badge'}">${open ? 'Abierto' : 'Cerrado'}</span>
                <span class="ms-2">Hoy: ${today}</span>
              </div>
              <a class="small text-decoration-none" data-bs-toggle="collapse" href="#${collapseId}" role="button" aria-expanded="false" aria-controls="${collapseId}">
                <i class="bi bi-clock-history"></i> Ver horarios
              </a>
              <div class="collapse mt-2" id="${collapseId}">
                ${generateHoursListHTML(m)}
              </div>
              <div class="mt-auto d-flex justify-content-between align-items-center pt-3">
                <span class="text-warning" aria-label="Calificación">${stars}<span class="text-muted">${empties}</span></span>
                <div class="btn-group">
                  <a class="btn btn-outline-success btn-sm" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(m.name + ' ' + m.address)}" target="_blank" rel="noopener"><i class="bi bi-map"></i> Mapa</a>
                  <button class="btn btn-success btn-sm" data-id="${m.id}" data-bs-toggle="modal" data-bs-target="#detailModal"><i class="bi bi-eye"></i> Ver</button>
                </div>
              </div>
            </div>
          </article>
        </div>`;
        }

        function applyFilters(list) {
            const q = state.q.trim().toLowerCase();
            let res = list.filter(m =>
                (state.category === 'all' || m.category === state.category) &&
                (!state.subcategory || m.subcategory === state.subcategory) &&
                (!state.open || isOpenNow(m.hours)) &&
                (!q || m.name.toLowerCase().includes(q) || m.tags.some(t => t.toLowerCase().includes(q)))
            );
            switch (state.sort) {
                case 'name-asc': res.sort((a, b) => a.name.localeCompare(b.name)); break;
                case 'name-desc': res.sort((a, b) => b.name.localeCompare(a.name)); break;
                case 'rating-desc': res.sort((a, b) => b.rating - a.rating); break;
            }
            return res;
        }

        function render() {
            const grid = document.getElementById('grid');
            if (!grid) return;
            const data = applyFilters(merchants);
            grid.innerHTML = data.map(cardTemplate).join('');
            // bind modal buttons
            grid.querySelectorAll('button[data-id]').forEach(btn => {
                btn.addEventListener('click', () => openDetail(btn.dataset.id));
            });
        }

        // ==================
        // Modal detalle
        // ==================
        function openDetail(id) {
            const m = merchants.find(x => x.id === id);
            if (!m) return;
            const t = document.getElementById('detailTitle');
            const i = document.getElementById('detailImg');
            const c = document.getElementById('detailCategory');
            const s = document.getElementById('detailSubcategory');
            const a = document.getElementById('detailAddress');
            const p = document.getElementById('detailPhone');
            const w = document.getElementById('detailSite');
            const ul = document.getElementById('detailHours');
            const mapsBtn = document.getElementById('mapsBtn');
            if (t) t.textContent = m.name;
            if (i) { i.src = m.img; i.alt = m.name; }
            if (c) c.textContent = m.category;
            if (s) s.textContent = m.subcategory || '';
            if (a) a.textContent = m.address;
            if (p) { p.textContent = m.phone || '—'; p.href = m.phone ? `tel:${m.phone.replace(/\s|\+/g, '')}` : '#'; }
            if (w) { w.textContent = m.site || '—'; w.href = m.site || '#'; }
            if (ul) {
                ul.innerHTML = '';
                for (let d = 0; d < 7; d++) {
                    const li = document.createElement('li');
                    const slots = m.hours[d] || [];
                    li.textContent = `${dayNames[d]}: ${slots.length ? slots.join(' · ') : 'Cerrado'}`;
                    ul.appendChild(li);
                }
            }
            if (mapsBtn) { mapsBtn.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(m.name + ' ' + m.address)}`; }
        }

        // ==================
        // Init UI bindings
        // ==================
        const qEl = document.getElementById('q');
        if (qEl) { qEl.addEventListener('input', (e) => { state.q = e.target.value; render(); }); }

        const openEl = document.getElementById('openNow');
        if (openEl) { openEl.addEventListener('change', (e) => { state.open = e.target.checked; render(); }); }

        const sortEl = document.getElementById('sort');
        if (sortEl) { sortEl.addEventListener('change', (e) => { state.sort = e.target.value; render(); }); }

        const allChip = document.querySelector('[data-category="all"]');
        if (allChip) {
            allChip.addEventListener('click', (e) => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                e.currentTarget.classList.add('active');
                state.category = 'all'; state.subcategory = '';
                const subBtn = document.getElementById('subcatBtn');
                if (subBtn) subBtn.textContent = 'Subcategoría';
                buildSubcategories(); render();
            });
        }

        // Primer render
        buildChips();
        buildSubcategories();
        render();

        // Año footer
        const yearEl = document.getElementById('year');
        if (yearEl) { yearEl.textContent = new Date().getFullYear(); }
    </script>
</body>

</html>